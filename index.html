<!DOCTYPE html>
<html>
	<title>&nbsp;</title>
	<head>
		<style>
            #brujula{
                width:199px;
                margin:auto;
                display:block
            }
			#compass{
				position:absolute;
				z-index: 1;
			}
			#needle{
				position:absolute;
				z-index: 2;
			}
            #map-canvas { height: 300px; width:100%; background-color:#cccccc  }
</style>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
		<meta name="viewport" content="initial-scale=1.0, user-scalable=no" />

		<link rel="stylesheet" href="http://code.jquery.com/mobile/1.2.0/jquery.mobile-1.2.0.min.css" />
		<script src="http://code.jquery.com/jquery-1.8.2.min.js"></script>
		<script src="http://code.jquery.com/mobile/1.2.0/jquery.mobile-1.2.0.min.js"></script>
		<script src="phonegap.js"></script>
		<script type="text/javascript"  src="jqRotate.js"></script>
        <script src="https://maps.googleapis.com/maps/api/js?v=3.exp&sensor=false"></script>
    <script>
/*var map;
function initialize() {
  var mapOptions = {
    zoom: 8,
    center: new google.maps.LatLng(-34.397, 150.644),
    mapTypeId: google.maps.MapTypeId.ROADMAP
  };
  map = new google.maps.Map(document.getElementById('map-canvas'),
      mapOptions);
}

google.maps.event.addDomListener(window, 'load', initialize);*/
        var map;

function initialize() {
  var mapOptions = {
    zoom: 15,
    mapTypeId: google.maps.MapTypeId.ROADMAP
  };
  map = new google.maps.Map(document.getElementById('map-canvas'),
      mapOptions);

  // Try HTML5 geolocation
  if(navigator.geolocation) {
    navigator.geolocation.getCurrentPosition(function(position) {
      var pos = new google.maps.LatLng(position.coords.latitude,
                                       position.coords.longitude);

      var infowindow = new google.maps.InfoWindow({
        map: map,
        position: pos,
        content: 'Location found using HTML5.'
      });

      map.setCenter(pos);
    }, function() {
      handleNoGeolocation(true);
    });
  } else {
    // Browser doesn't support Geolocation
    handleNoGeolocation(false);
  }
}

function handleNoGeolocation(errorFlag) {
  if (errorFlag) {
    var content = 'Error: The Geolocation service failed.';
  } else {
    var content = 'Error: Your browser doesn\'t support geolocation.';
  }

  var options = {
    map: map,
    position: new google.maps.LatLng(60, 105),
    content: content
  };

  var infowindow = new google.maps.InfoWindow(options);
  map.setCenter(options.position);
}

google.maps.event.addDomListener(window, 'load', initialize);

    </script>
	</head>
	<body >
		<!-- Start of first page I -->
		<div data-role="page" id="page1">
			<!-- Header -->
			<div data-role="header">
				<h1>GCB</h1>

			</div>
			<!-- /header -->
			<!-- Content    -->
			<div data-role="content">
				<div data-role="content">
					<ul data-role="listview" data-inset="true">
						<li><a href="#bru">Brujula</a></li>
						<li><a href="#historial">Historial</a></li>
						<li><a href="#priv">Privacidad</a></li>
					</ul>		
				</div>
			</div>
			<!-- /content -->
			<!-- footer -->
			<div data-role="footer" data-position="fixed">
				<h2>&copy; 2013 pisd</h2>
			</div>
			<!-- /footer -->
		</div>
		<!-- /page -->
		
		
		<!-- BRUJULA    -->
			<div data-role="page" id="bru">
				<div data-role="header">
					<h1>Brujula 1.0</h1>
					<a data-role="button" data-direction="reverse" data-rel="back" href="#page1" data-icon="delete" data-iconpos="notext" class="ui-btn-right" data-theme="f" ></a>
        	</div>
        	<div data-role="content" style="padding-top: 20px;">	
				<div id="brujula">
                    <img src="img/compass.png" id="compass" />
                    <img src="img/needle.png" id="needle" />
                    </div>
				<p></p>
				<div id="map-canvas" style="width:100%; height: 300px; margin-top:210px; "></div>
			</div>
			</div>
			<!-- /brujula -->
	</body>
	<script>
		document.addEventListener("deviceready", onDeviceReady, false); 

	function onDeviceReady() { 
		startCompass(); 
	}

	function startCompass() {

		var options = {
			frequency : 50 
		};

		navigator.compass.watchHeading(onSuccess, onError, options); 
	}

	function onSuccess(heading) {

		$("#needle").rotate(-heading.magneticHeading); 
	}

	function onError(compassError) { 
		alert('Compass error: ' + compassError.code); 
	}
	</script>
</html>